{# PHENOTYPE: NARRATIVE_EVIDENCE_FOR_MOTIVE #}

// Phenotype: NARRATIVE_EVIDENCE_FOR_MOTIVE
// Primary Goal: To create a structured three-passage sequence for revealing evidence related to a character's motive.
// This sequence includes an initial narrative announcement, an action-only passage for the reveal mechanics, 
// and a follow-up narrative passage for commentary and progression.
// Inspired by the NARRATIVE_EVIDENCE_FOR_FLASHBACK pattern.

PROCEDURE GenerateMotiveEvidenceSequence(stepIDPrefix, motiveID, sourceEvidenceID, initialNarrativeText, evidenceContextText, followUpNarrativeText, nextPassageID)
    // --- Input Parameters ---
    // stepIDPrefix: (String) Base prefix for generating unique passage UIDs.
    // motiveID: (String) The Motive_Definition this evidence pertains to (for context/naming, e.g., "REVENGE_MOTIVE_AGAINST_VICTIM").
    // sourceEvidenceID: (String) The unique ID (aet) of the pre-defined evidence item implying/stating the motive (e.g., "threatening_letter_001").
    // initialNarrativeText: (String) Narrative text for the initial discovery passage (e.g., "A closer look at the victim's emails reveals a disturbing exchange...").
    // evidenceContextText: (String) Descriptive text for the sourceEvidenceID item itself, used during the REVEAL action (e.g., "An email detailing threats made by the suspect.").
    // followUpNarrativeText: (String) Narrative text for the follow-up commentary passage (e.g., "This email clearly points to a strong motive for revenge...").
    // nextPassageID: (String) The UID of the passage to transition to after the follow-up commentary (e.g., "CONFRONT_SUSPECT_WITH_MOTIVE").

    // --- Pseudocode for Runner ---
    // 1. Define Unique Identifiers (UIDs) for the three passages:
    DEFINE initialRevealUID = stepIDPrefix + "_initialMotive_" + sourceEvidenceID
    DEFINE actionRevealUID = stepIDPrefix + "_actionMotive_" + sourceEvidenceID
    DEFINE followUpCommentaryUID = stepIDPrefix + "_followupMotive_" + sourceEvidenceID

    // 2. Define a base tag for all passages generated by this phenotype:
    DEFINE phenotypeTag = "NARRATIVE_EVIDENCE_FOR_MOTIVE"

    // 3. Construct Passage 1: Initial Narrative Discovery
    //    Purpose: Inform the player of the potential motive-related discovery and provide an explicit action to examine the evidence.
    //    SLPN Structure: PSG -> BOT (with initialNarrativeText) -> BRN -> BOP (links to actionRevealUID)
    
    CREATE SLPN_Passage1:
        SET UID = initialRevealUID
        SET Name = "Motive Clue: " + motiveID + " (" + sourceEvidenceID + ")"
        SET Tags = phenotypeTag + "|MOTIVE_DISCOVERY"
        
        ADD BOT_Message:
            SET Line = initialNarrativeText
        
        ADD BRANCH_Point:
            SET Description = "Investigate this lead?"
            SET Replayable = "once"
            SET Presentation = "option-list"
            SET InteractionType = "blocking"
            
            ADD BRANCH_Option:
                SET Name = "Examine evidence: " + sourceEvidenceID
                SET Description = "Look into this piece of evidence."
                ADD ACTION_Command:
                    SET Type = "MOVE"
                    ADD MOVE_Target:
                        SET Type = "passage"
                        SET TargetUID = actionRevealUID
    
    // 4. Construct Passage 2: Action-Only Evidence Reveal for Motive
    //    Purpose: Handle the mechanics of revealing the motive-related evidence and setting up the first-view trigger.
    //    This passage contains NO BOT messages or direct narrative from the game.
    //    SLPN Structure: PSG -> ACT (REVEAL sourceEvidenceID with evidenceContextText) -> ACT (MOVE to evidence view) -> TRG (FIRST-VIEW -> MOVE to followUpCommentaryUID)

    CREATE SLPN_Passage2:
        SET UID = actionRevealUID
        SET Name = "Revealing Motive Evidence: " + sourceEvidenceID
        SET Tags = phenotypeTag + "|MOTIVE_ACTION_REVEAL"
        // IMPORTANT: No BOT command in this passage.
        
        ADD ACTION_Command_Reveal:
            SET Type = "REVEAL"
            SET EvidenceTarget = sourceEvidenceID
            SET EvidenceText = evidenceContextText // Text to associate with the evidence item itself
        
        ADD ACTION_Command_MoveToEvidence:
            SET Type = "MOVE"
            ADD MOVE_Target:
                SET Type = "evidence" // Moves player focus to the evidence viewer/tab
                SET TargetUID = sourceEvidenceID
        
        ADD TRIGGER_Command_FirstView:
            SET TriggerType = "FIRST-VIEW"
            SET TriggerTarget = sourceEvidenceID // The evidence ID to monitor for first view
            ADD ACTION_Command_OnTrigger:
                SET Type = "MOVE"
                ADD MOVE_Target:
                    SET Type = "passage"
                    SET TargetUID = followUpCommentaryUID

    // 5. Construct Passage 3: Follow-up Commentary on Motive
    //    Purpose: Provide narrative insight about the motive after the player has viewed the evidence and guide them to the next step.
    //    SLPN Structure: PSG -> BOT (with followUpNarrativeText) -> BRN -> BOP (links to nextPassageID)

    CREATE SLPN_Passage3:
        SET UID = followUpCommentaryUID
        SET Name = "Motive Insight: " + motiveID
        SET Tags = phenotypeTag + "|MOTIVE_FOLLOWUP"
        
        ADD BOT_Message:
            SET Line = followUpNarrativeText
        
        ADD BRANCH_Point:
            SET Description = "What's your next step?"
            SET Replayable = "once"
            SET Presentation = "option-list"
            SET InteractionType = "blocking"
            
            ADD BRANCH_Option:
                SET Name = "Continue based on this motive"
                SET Description = "Consider this motive and proceed."
                ADD ACTION_Command:
                    SET Type = "MOVE"
                    ADD MOVE_Target:
                        SET Type = "passage"
                        SET TargetUID = nextPassageID
                        
    // 6. Assemble the final SLPN output string, concatenating the SLPN for Passage1, Passage2, and Passage3, separated by double newlines.
    RETURN SLPN_Passage1 + "\n\n" + SLPN_Passage2 + "\n\n" + SLPN_Passage3
END_PROCEDURE


// --- Example Usage (Illustrative) ---
/*
CALL GenerateMotiveEvidenceSequence(
    stepIDPrefix = "CASE02_MOTIVE_SEQ_B",
    motiveID = "FINANCIAL_GAIN_MOTIVE",
    sourceEvidenceID = "bank_statement_004",
    initialNarrativeText = "Reviewing the suspect's financials, an unusually large transaction catches your eye right before the incident.",
    evidenceContextText = "Bank Statement: Shows a deposit of $500,000 the day before the crime. Source: Unknown Benefactor.",
    followUpNarrativeText = "This large, unexplained sum of money strongly suggests a financial motive. Where did this money come from?",
    nextPassageID = "INVESTIGATE_FINANCIAL_TRAIL"
)
*/

// --- Sample SLPN Output (Based on the example usage) ---
/*
PSG:uid=CASE02_MOTIVE_SEQ_B_initialMotive_bank_statement_004;nam="Motive Clue: FINANCIAL_GAIN_MOTIVE (bank_statement_004)";tag=NARRATIVE_EVIDENCE_FOR_MOTIVE|MOTIVE_DISCOVERY;BOT:lin="Reviewing the suspect's financials, an unusually large transaction catches your eye right before the incident.";brn=BRN:bds="Investigate this lead?";brp=once;bpr=option-list;bit=blocking;ops=BOP:onm="Examine evidence: bank_statement_004";ods="Look into this piece of evidence.";act=ACT:aty=MOVE;amt=AMT:typ=passage;tgt=CASE02_MOTIVE_SEQ_B_actionMotive_bank_statement_004;

PSG:uid=CASE02_MOTIVE_SEQ_B_actionMotive_bank_statement_004;nam="Revealing Motive Evidence: bank_statement_004";tag=NARRATIVE_EVIDENCE_FOR_MOTIVE|MOTIVE_ACTION_REVEAL;ACT:aty=REVEAL;aet=bank_statement_004;axt="Bank Statement: Shows a deposit of $500,000 the day before the crime. Source: Unknown Benefactor.";ACT:aty=MOVE;amt=AMT:typ=evidence;tgt=bank_statement_004;TRG:typ=FIRST-VIEW;tgt=bank_statement_004;act=ACT:aty=MOVE;amt=AMT:typ=passage;tgt=CASE02_MOTIVE_SEQ_B_followupMotive_bank_statement_004;

PSG:uid=CASE02_MOTIVE_SEQ_B_followupMotive_bank_statement_004;nam="Motive Insight: FINANCIAL_GAIN_MOTIVE";tag=NARRATIVE_EVIDENCE_FOR_MOTIVE|MOTIVE_FOLLOWUP;BOT:lin="This large, unexplained sum of money strongly suggests a financial motive. Where did this money come from?";brn=BRN:bds="What's your next step?";brp=once;bpr=option-list;bit=blocking;ops=BOP:onm="Continue based on this motive";ods="Consider this motive and proceed.";act=ACT:aty=MOVE;amt=AMT:typ=passage;tgt=INVESTIGATE_FINANCIAL_TRAIL;
*/

{# END_PHENOTYPE: NARRATIVE_EVIDENCE_FOR_MOTIVE #}
